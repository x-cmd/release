# shellcheck shell=dash

(
    git clone git@github.com:x-cmd/release

    distfolder="$PWD/release/dist"
    sumfolder="$PWD/release/sum"
    index_yml="$PWD/release/index.yml"
    mkdir -p "$distfolder" "$sumfolder"

    # x gita git@github.com:x-cmd/x-cmd-version release "$distfolder" "$sumfolder"
    (
        git clone git@github.com:x-cmd/x-cmd-version
        cd x-cmd-version || {
            x:error "Cannot cd to release"
            exit 1
        }

        xws release "$distfolder" "$sumfolder" || exit 1

        x:info "Copy $PWD/version/index.yml ==> $index_yml"
        cp -rf version/index.yml "$index_yml"
    ) && (
        cd release || {
            x:error "Cannot cd to release"
            exit 1
        }

        git add .
        git status -s
        git commit -m ...
        git push git@github.com:x-cmd/release main
        git push git@gitee.com:x-cmd/release main
        git push git@gitcode.net:x-cmd/release main
    )
)
