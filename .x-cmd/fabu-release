# shellcheck shell=dash

(
    command git clone git@github.com:x-cmd/release

    distfolder="$PWD/release/dist"
    sumfolder="$PWD/release/sum"
    index_yml="$PWD/release/index.yml"
    ___x_cmd_cmds_mkdir -p "$distfolder" "$sumfolder"

    # x gita git@github.com:x-cmd/x-cmd-version release "$distfolder" "$sumfolder"
    (
        command git clone command git@github.com:x-cmd/x-cmd-version
        ___x_cmd_cmds_cd x-cmd-version || {
            x:error "Cannot ___x_cmd_cmds_cd to release"
            exit 1
        }

        x ws release "$distfolder" "$sumfolder" || exit 1

        x:info "Copy $PWD/version/index.yml ==> $index_yml"
        cp -rf version/index.yml "$index_yml"
        command git add version/index.yml
        command git status -s
        command git commit -m "Update: version/index.yml"
        x ws push
    ) && (
        ___x_cmd_cmds_cd release || {
            x:error "Cannot ___x_cmd_cmds_cd to release"
            exit 1
        }

        command git add .
        command git status -s
        command git commit -m ...
        command git push git@github.com:x-cmd/release main
        command git push git@gitee.com:x-cmd/release main
        command git push git@gitcode.net:x-cmd/release main
    )
)
